<?xml version="1.0" encoding="UTF-8"?>
<server description="new server">

    <!-- Enable features -->
    <featureManager>
        <feature>jakartaee-8.0</feature>
        <feature>cdi-2.0</feature>
        <feature>jndi-1.0</feature>
        <feature>adminCenter-1.0</feature>
        <feature>ejbRemote-3.2</feature>
        <feature>wasJmsClient-2.0</feature>
        <feature>wasJmsServer-1.0</feature>
        <feature>appSecurity-2.0</feature>
        <feature>transportSecurity-1.0</feature>
        <!--
        <feature>appClientSupport-1.0</feature>
        <feature>appSecurity-2.0</feature>
        <feature>transportSecurity-1.0</feature>
        <feature>jsp-2.3</feature>
        <feature>ejb-3.2</feature>
        <feature>cdi-2.0</feature>
        <feature>ejbRemote-3.2</feature>
        <feature>localConnector-1.0</feature>
        <feature>jndi-1.0</feature>
        -->
        <!-- <feature>replicatedCache-1.0</feature> -->
    </featureManager>

    <!-- To access this server from a remote client add a host attribute to the following element, e.g. host="*" -->
    <httpEndpoint id="defaultHttpEndpoint" host="*" httpPort="9080" httpsPort="9443"/>

    <!-- Default SSL configuration enables trust for default certificates from the Java runtime --> 
    <ssl id="defaultSSLConfig" 
        keyStoreRef="defaultKeyStore" 
        trustStoreRef="defaultTrustStore" 
        trustDefaultCerts="true"
        clientAuthenticationSupported="true" 
    />
    <!--
        sslProtocol="TLSv1.3, TLSv1.2"
    -->

    <keyStore id="defaultKeyStore" password="diamigoyentra" />


    <!-- default policy -->
    <orb id="defaultOrb">
        <serverPolicy.csiv2>
            <layers>
                <attributeLayer identityAssertionEnabled="false"/>
                <authenticationLayer mechanisms="LTPA,GSSUP" establishTrustInClient="Required"/>
                <transportLayer sslRef="defaultSSLConfig"/>
            </layers>
        </serverPolicy.csiv2>
        <clientPolicy.csiv2>
            <layers>
                <attributeLayer identityAssertionEnabled="false"/>
                <authenticationLayer mechanisms="LTPA,GSSUP" establishTrustInClient="Supported"/>
                <transportLayer sslRef="defaultSSLConfig"/>
            </layers>
        </clientPolicy.csiv2>
    </orb>

    <!--
    <iiopEndpoint id="defaultIiopEndpoint" jndiName="jndi/default" host="*" iiopPort="2809" iiopsPort="2810" />
    -->
    <iiopEndpoint id="defaultIiopEndpoint" host="192.168.0.190" iiopPort="2809" tcpOptionsRef="defaultIiopOptions" />
    <iiopsOptions id="defaultIiopOptions"
                iiopsPort="2810"
                sslRef="defaultSSLConfig"

    />
    <!--
    <replicatedCache id="myCache"
                    replicationDomain="myDomain"
                    members="openliberty01, openliberty02"
                    dataSourceRef="jdbc/postgresql"
                    />
    -->

    <dataSource id="postgresql" jndiName="jdbc/openlibertydb">
        <jdbcDriver libraryRef="PostgreSQLLib"/>
        <properties databaseName="openlibertydb" serverName="postgresql" portNumber="5432" user="postgres" password="admin"/>
    </dataSource>

    <library id="PostgreSQLLib">
        <fileset dir="/home/javi/" includes="postgresql-42.6.0.jar"/>
    </library>

    <!-- this one is not in server-configuration-overview for openliberty -->
    <!--                         dataSourceRef="jdbc/postgresql"  -->
    <replicationDomain id="openLibertyDomain" dataSourceRef="postgresql" members="openliberty01, openliberty02">
        <fileStore dir="replicationStore"/>
    </replicationDomain>

    <ejbContainer replicationDomainRef="openLibertyDomain">
      <session id="EjbSessionRemotePoc" type="Stateful">
        <!--<jndiName>EjbBean</jndiName>-->
        <jndiName>com.ibm.ws.ejbcontainer.osgi.internal.naming.EJBRemoteReferenceBinding</jndiName>

        <ejbClass>org.ratoncio.EjbSessionPocRemote</ejbClass>
      </session>
    </ejbContainer>

    <!-- Automatically expand WAR files and EAR files -->
    <applicationManager autoExpand="true"/>


    <member>
        <clusterMember hostname="openliberty01" httpPort="9080" httpsPort="9443" userName="admin" password="admin" weight="1"/>
    </member>
    <member>
        <clusterMember hostname="openliberty02" httpPort="9080" httpsPort="9443" userName="admin" password="admin" weight="2"/>
    </member>


    <!-- apparently is needed for remoteEJB-3.2 -->
    <!-- <basicRegistry id="basic" realm="dummyRealm"> -->
    <basicRegistry id="basic">
        <user name="javi" password="javi"/>
        <user name="admin" password="admin"/>
    </basicRegistry>
    <administrator-role>
        <user>admin</user>
    </administrator-role>
    
    <remoteFileAccess>
        <writeDir>${server.config.dir}</writeDir>
    </remoteFileAccess>

    <messagingEngine>
        <queue id="cola01" />
    </messagingEngine>
    <wasJmsEndpoint host="*" wasJmsPort="7276" wasJmsSSLPort="7286"/>

    <jmsQueueConnectionFactory jndiName="jms/JmsFactory">
        <properties.wasJms remoteServerAddress="localhost:7276:BootStrapBasicMessaging" />
    </jmsQueueConnectionFactory>

    <jmsQueue id="simpleJmsQueue" jndiName="jms/JmsQueue">
        <properties.wasJms queueName="cola01" />
    </jmsQueue>

 </server>
